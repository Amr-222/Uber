@model Uber.BLL.ModelVM.Driver.DriverProfileEditVM
@{
    ViewData["Title"] = "Driver Profile";
}

<div class="profile-container">
    <aside class="sidebar">
        <div class="user-info">
            <div class="icon-placeholder">
                @if (!string.IsNullOrEmpty(Model.ImagePath))
                {
                    <img src="~/Files/@Model.ImagePath" alt="Driver Photo" class="user-icon" />
                }
                else
                {
                    <i class="fas fa-user"></i>
                }
            </div>
            <h3>@Model.Name</h3>
        </div>

        <ul>
            <li data-tab="rides" class="active">🚗 Completed Rides</li>
            <li data-tab="payment">💳 Earnings</li>
            <li>
                <a href="/Home/Help" style="color: inherit; text-decoration: none;">❓ Help</a>
            </li>
            <li data-tab="settings">⚙ Settings</li>
        </ul>
    </aside>

    <main class="content">
        <section id="rides" class="tab-content active">
            <h2>Completed Rides</h2>
            @if (Model.Rides != null && Model.Rides.Any())
            {
                foreach (var ride in Model.Rides)
                {
                    <div class="ride-card">
                        <p><strong>From:</strong> @ride.StartLat,@ride.StartLng</p>
                        <p><strong>To:</strong> @ride.EndLat,@ride.EndLng</p>
                        <p><strong>Date & Time:</strong> @ride.CreatedAt.ToString("dd MMM yyyy - HH:mm")</p>
                        <p><strong>Price:</strong> @ride.Price EGP</p>
                        <p><strong>Passenger:</strong> @ride.User.Name</p>
                    </div>
                }
            }
            else
            {
                <p class="empty-msg">No rides yet.</p>
            }
        </section>

        <section id="payment" class="tab-content">
            <h2>Total Earnings</h2>
            <p><strong>@Model.Balance</strong> EGP</p>
        </section>

        <section id="settings" class="tab-content">
            <h2 style="text-align:center; margin-bottom: 20px;">Profile</h2>
            
            @if (TempData["SuccessMessage"] != null)
            {
                <div class="alert alert-success" style="text-align: center; margin-bottom: 20px; padding: 10px; background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 5px;">
                    @TempData["SuccessMessage"]
                </div>
            }

            <div class="edit-controls">
                <button type="button" id="editBtn" class="btn-edit">Edit Profile</button>
                <button type="button" id="cancelBtn" class="btn-cancel" style="display: none;">Cancel</button>
            </div>

            <form asp-controller="Driver" asp-action="EditDriver" method="post" enctype="multipart/form-data" class="edit-driver-form" id="driverForm">

                <div class="form-group">
                    <label>Name</label>
                    <input asp-for="Name" type="text" class="form-control" required readonly />
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <input asp-for="Email" type="email" class="form-control" required readonly />
                </div>

                <div class="form-group">
                    <label>Phone Number</label>
                    <input asp-for="Phone" type="tel" class="form-control" required pattern="^0(10|11|12|15)\d{8}$" placeholder="01012345678" maxlength="11" readonly />
                </div>

                <div class="form-group">
                    <label>Gender</label>
                    <input type="text" class="form-control" value="@Model.Edit.Gender" readonly />
                </div>

                <div class="form-group">
                    <label>Date of Birth</label>
                    <input asp-for="Dateofbirth" type="date" min="1925-01-01" max="2007-12-31" required readonly />
                </div>

                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-control" value="********" readonly />
                </div>

                <h3 style="margin-top: 20px;">Vehicle Info</h3>

                <div class="form-group">
                    <label>Brand</label>
                    <input asp-for="Vehicle.Brand" type="text" class="form-control" required readonly />
                </div>

                <div class="form-group">
                    <label>Model</label>
                    <input asp-for="Vehicle.Model" type="text" class="form-control" required readonly />
                </div>

                <div class="form-group">
                    <label>Year</label>
                    <input asp-for="Vehicle.YearMade" type="number" min="2008" max="2025" class="form-control" required readonly />
                </div>

                <div class="form-group">
                    <label>Plate</label>
                    <input asp-for="Vehicle.Plate" type="text" class="form-control" required readonly />
                </div>

                <div class="form-group">
                    <label>Color</label>
                    <input asp-for="Vehicle.Color" type="text" class="form-control" required readonly />
                </div>

                <div class="form-group">
                    <label>Seating Capacity</label>
                    <input asp-for="Vehicle.SeatingCapacity" type="number" min="1" max="14" class="form-control" required readonly />
                </div>

                <div class="form-group">
                    <label>Vehicle Type</label>
                    <div class="radio-group">
                        <label><input asp-for="Vehicle.Type" type="radio" value="Car" /> Car</label>
                        <label><input asp-for="Vehicle.Type" type="radio" value="Scooter" /> Scooter</label>
                        <label><input asp-for="Vehicle.Type" type="radio" value="Shuttle" /> Shuttle</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Transmission</label>
                    <div class="radio-group">
                        <label><input asp-for="Vehicle.Transmission" type="radio" value="Manual" /> Manual</label>
                        <label><input asp-for="Vehicle.Transmission" type="radio" value="Automatic" /> Automatic</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Engine</label>
                    <div class="radio-group">
                        <label><input asp-for="Vehicle.VehicleEngine" type="radio" value="Gasoline" /> Gas</label>
                        <label><input asp-for="Vehicle.VehicleEngine" type="radio" value="Electric" /> Electric</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Upload Image</label>
                    <input asp-for="File" type="file" class="form-control" disabled />
                </div>

                <button type="submit" class="btn-save" disabled>Save</button>
            </form>
        </section>
    </main>
</div>

<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<script>
    document.querySelectorAll(".sidebar ul li[data-tab]").forEach(item => {
        item.addEventListener("click", () => {
            document.querySelectorAll(".sidebar ul li").forEach(li => li.classList.remove("active"));
            document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));

            item.classList.add("active");
            document.getElementById(item.dataset.tab).classList.add("active");
        });
    });

    // Edit confirmation functionality
    let isEditMode = false;
    let originalValues = {};

    document.getElementById('editBtn').addEventListener('click', function() {
        if (!isEditMode) {
            // Store original values
            const form = document.getElementById('driverForm');
            const inputs = form.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="date"], input[type="number"]');
            
            inputs.forEach(input => {
                originalValues[input.name] = input.value;
            });

            // Show confirmation dialog
            const confirmed = confirm('Are you sure you want to edit your profile? You will be able to modify your personal and vehicle information.');
            
            if (confirmed) {
                // Enable form fields
                inputs.forEach(input => {
                    input.readOnly = false;
                });
                
                // Enable file upload and save button
                document.querySelector('input[type="file"]').disabled = false;
                document.querySelector('.btn-save').disabled = false;
                
                // Show cancel button, hide edit button
                document.getElementById('editBtn').style.display = 'none';
                document.getElementById('cancelBtn').style.display = 'inline-block';
                
                isEditMode = true;
            }
        }
    });

    document.getElementById('cancelBtn').addEventListener('click', function() {
        if (isEditMode) {
            // Restore original values
            const form = document.getElementById('driverForm');
            const inputs = form.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="date"], input[type="number"]');
            
            inputs.forEach(input => {
                if (originalValues[input.name]) {
                    input.value = originalValues[input.name];
                }
                input.readOnly = true;
            });
            
            // Disable file upload and save button
            document.querySelector('input[type="file"]').disabled = true;
            document.querySelector('.btn-save').disabled = true;
            
            // Show edit button, hide cancel button
            document.getElementById('editBtn').style.display = 'inline-block';
            document.getElementById('cancelBtn').style.display = 'none';
            
            isEditMode = false;
        }
    });

    // Form submission confirmation
    document.getElementById('driverForm').addEventListener('submit', function(e) {
        if (isEditMode) {
            const confirmed = confirm('Are you sure you want to save these changes? This will update your profile information.');
            if (!confirmed) {
                e.preventDefault();
            }
        }
    });
</script>

<style>
    html, body {
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        height: 100%;
    }

    .profile-container {
        display: flex;
        min-height: 100vh;
        background: #f8f9fa;
    }

    .sidebar {
        width: 220px;
        background: #000;
        color: #fff;
        padding: 20px 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: fixed;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 100;
    }

    .user-info {
        text-align: center;
        padding: 15px 0;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        margin-bottom: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .icon-placeholder {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: #1CB5A3;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 8px;
        font-size: 35px;
        color: #fff;
    }

    .user-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
    }

    .user-info h3 {
        font-size: 16px;
        margin: 0;
        color: #fff;
    }

    .sidebar ul {
        list-style: none;
        padding: 0;
        width: 100%;
    }

        .sidebar ul li {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.3s ease;
            text-align: left;
        }

            .sidebar ul li:hover,
            .sidebar ul li.active {
                background: #1CB5A3;
            }

            .sidebar ul li a {
                display: block;
                color: inherit;
                text-decoration: none;
            }

    .content {
        flex: 1;
        margin-left: 220px;
        padding: 20px;
    }

    .tab-content {
        display: none;
    }

        .tab-content.active {
            display: block;
        }

    .ride-card {
        background: #fff;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .empty-msg {
        color: #777;
        font-style: italic;
    }

    .btn-update {
        display: inline-block;
        padding: 10px 15px;
        background: #1CB5A3;
        color: #fff;
        text-decoration: none;
        border-radius: 6px;
    }

        .btn-update:hover {
            background: #17a38a;
        }

    .edit-driver-form {
        max-width: 600px;
        margin: auto;
        background: #fff;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .edit-driver-form .form-group {
        margin-bottom: 15px;
    }

    .edit-driver-form label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
    }

    .edit-driver-form input[type="text"],
    .edit-driver-form input[type="email"],
    .edit-driver-form input[type="password"],
    .edit-driver-form input[type="number"],
    .edit-driver-form input[type="date"],
    .edit-driver-form input[type="file"] {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
    }

    .edit-driver-form .radio-group label {
        margin-right: 15px;
        font-weight: 500;
        cursor: pointer;
    }

    .btn-save {
        width: 100%;
        padding: 12px;
        background: #1CB5A3;
        color: #fff;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.3s;
    }

    .btn-save:hover {
        background: #17a38a;
    }

    .edit-controls {
        text-align: center;
        margin-bottom: 20px;
    }

    .btn-edit, .btn-cancel {
        padding: 10px 20px;
        margin: 0 10px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        transition: 0.3s;
    }

    .btn-edit {
        background: #1CB5A3;
        color: #fff;
    }

    .btn-edit:hover {
        background: #17a38a;
    }

    .btn-cancel {
        background: #dc3545;
        color: #fff;
    }

    .btn-cancel:hover {
        background: #c82333;
    }

    .edit-driver-form input[readonly] {
        background-color: #f8f9fa;
        cursor: not-allowed;
    }

    .edit-driver-form input[disabled] {
        background-color: #f8f9fa;
        cursor: not-allowed;
    }
</style>
